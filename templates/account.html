{% extends "layout.html" %}

{% block title %}Your Account{% endblock %}

{% block content %}

<div class="max-w-lg mx-auto bg-black/50 p-6 rounded-xl text-white text-center">

    <h2 class="text-4xl font-bold mb-4">Account</h2>

    <p class="text-xl mb-6">
        Logged in as: <span class="font-bold text-yellow-300">{{ username }}</span>
    </p>

    <!-- Avatar Upload -->
    <div class="mb-6 text-center">
        <h3 class="text-3xl font-semibold mb-4">Profile Picture</h3>

        <form action="{{ url_for('upload_avatar') }}" method="POST" enctype="multipart/form-data"
            class="flex flex-col items-center justify-center gap-6">

            <img src="{{ url_for('uploaded_file', filename=profile.avatar) if profile.avatar
                else url_for('static', filename='img/default_pfp.png') }}"
                class="w-32 h-32 rounded-full object-cover border-4 border-white/20">

            <div class="flex flex-col items-center gap-2">
                <input type="file" name="avatar" accept="image/*"
                    class="text-sm text-gray-200">
                <button class="bg-yellow-400 text-black font-bold px-4 py-2 rounded-lg
                            hover:bg-yellow-500 transition text-sm">
                    Upload new avatar
                </button>
            </div>
        </form>
    </div>

    <h3 class="text-2xl font-semibold mb-3">Your Best Scores</h3>

    <div class="space-y-3 text-left">
        {% for item in stats %}
            {% set total = category_sizes.get(item.category, None) %}
            {% if total %}
                {% set raw = (item.best_score / total * 100) %}
                {% set percent = [raw, 100] | min | round(0) %}
            {% else %}
                {% set percent = item.best_score %}
            {% endif %}

            <div class="bg-black/40 p-3 rounded-lg flex justify-between">
                <span class="font-bold">{{ item.category | replace("_", " ") | title }}</span>
                <span>
                    <b>{{ percent }}%</b> - 
                    <b>{{ "%.2f"|format(item.best_time) }}s</b>
                </span>
            </div>
        {% endfor %}
    </div>


    {% if stats %}
    <form action="{{ url_for('clear_best_scores') }}" method="POST">
        <button class="mt-4 bg-black/60 text-white px-4 py-2 rounded w-full
                    hover:bg-red-700 transition font-bold"
                onclick="return confirm('Are you sure you wanna clear all best scores?');">
            Clear Best Scores
        </button>
    </form>
    {% else %}
    <p class="text-gray-400">No best scores yet!</p>
    {% endif %}

    <h3 class="text-2xl font-semibold mt-8 mb-3">Words You Failed</h3>

    {% if failed %}
    <div class="space-y-2">
        {% for item in failed %}
            <div class="bg-black/40 p-3 rounded-lg flex justify-between">
                <span>{{ item.word }}</span>
                <span class="text-yellow-300">{{ item.failures }}Ã—</span>
            </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="text-gray-400">No failed words yet!</p>
    {% endif %}
    {% if failed %}
    <form action="{{ url_for('clear_failed_words') }}" method="POST">
        <button class="mt-4 bg-black/60 text-white px-4 py-2 rounded w-full
                    hover:bg-red-700 transition font-bold">
            Clear Failed Words
        </button>
    </form>
    {% endif %}

    <form action="{{ url_for('logout') }}" method="get">
        <button class="mt-6 bg-red-500 text-white px-4 py-2 rounded font-bold hover:bg-red-600 w-full">
            Log out
        </button>
    </form>

</div>

{% endblock %}
